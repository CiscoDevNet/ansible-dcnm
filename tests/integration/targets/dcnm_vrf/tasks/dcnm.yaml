---
- name: debug testcase variable
  debug:
    var: testcase
  tags: sanity

# Handle wildcard patterns
- name: run all tests
  block:
    - name: set patterns for all tests
      set_fact:
        msd_pattern: "*.yaml"
        standalone_pattern: "*.yaml"
        mcfg_pattern: "*.yaml"
    - import_tasks: dcnm_mcfg.yaml
    - import_tasks: dcnm_msd.yaml
    - import_tasks: dcnm_standalone.yaml
  when: testcase == "*"
  tags: sanity

# Handle MCFG wildcard
- name: run all MCFG tests
  block:
    - name: set pattern for all MCFG tests
      set_fact:
        mcfg_pattern: "*.yaml"
    - import_tasks: dcnm_mcfg.yaml
  when: testcase == "mcfg/*"
  tags: sanity

# Handle MSD wildcard
- name: run all MSD tests
  block:
    - name: set pattern for all MSD tests
      set_fact:
        msd_pattern: "*.yaml"
    - import_tasks: dcnm_msd.yaml
  when: testcase == "msd/*"
  tags: sanity

# Handle standalone wildcard
- name: run all standalone tests
  block:
    - name: set pattern for all standalone tests
      set_fact:
        standalone_pattern: "{{ testcase }}"
    - import_tasks: dcnm_standalone.yaml
  when: testcase is match("standalone/.*")
  tags: sanity

# Handle specific MCFG test
- name: run specific MCFG test
  block:
    - name: extract MCFG test name
      set_fact:
        mcfg_test_name: "{{ testcase | regex_replace('^mcfg/', '') }}"
    - name: set pattern for specific MCFG test
      set_fact:
        mcfg_pattern: "{{ mcfg_test_name }}.yaml"
    - import_tasks: dcnm_mcfg.yaml
  when: testcase.startswith("mcfg/") and testcase != "mcfg/*"
  tags: sanity

# Handle specific MSD test
- name: run specific MSD test
  block:
    - name: extract MSD test name
      set_fact:
        msd_test_name: "{{ testcase | regex_replace('^msd/', '') }}"
    - name: set pattern for specific MSD test
      set_fact:
        msd_pattern: "{{ msd_test_name }}.yaml"
    - import_tasks: dcnm_msd.yaml
  when: testcase.startswith("msd/") and testcase != "msd/*"
  tags: sanity

# Handle specific standalone test
- name: run specific standalone test
  block:
    - name: set pattern for specific standalone test
      set_fact:
        standalone_pattern: "{{ testcase }}"
    - import_tasks: dcnm_standalone.yaml
  when: 
    - testcase is match("standalone/[^/]+\.yaml$")
  tags: sanity